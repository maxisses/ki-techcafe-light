# 3. Deploy Backend

Im Ordner "openshift" des gecloned GitRepos liegt eine Datei backend-env.env   
Da unsere backend-Funktionalität nicht von außerhalb \(so wie das Frontend vom Browser des jeweiligen Nutzers\) auf den Cluster zugreift nutzen wir hier den OpenShift Projektinternen Namen des mosquitto-Broker. Der ist einfach "mosquitto". Wenn man in der GUI in der DeveloperSicht in der Topologie auf den Kreis mosquitto klickt sieht man rechts unten den Service "mosquitto", welcher u.A. den Port 1883 freigibt.

![](../../../../.gitbook/assets/image%20%28122%29.png)

![](../../../../.gitbook/assets/image%20%2838%29.png)

Im Folgenden Befehl für das Deployment des Backends könnt ihr beim genauen hinsehen erkennen, dass alerdings ein zweites ENV File benötigt wird. Das Backend soll Daten vom MQTT Broker holen und in eine Datenbank schreiben damit wir mit dem Training eines Modells starten können. 

Als Datenbank nutzen wir eine relationale PostgreSQL Datenbank, gemanaged von der IBM Cloud. Diese wird euch gestellt und ihr müsst lediglich die Zugangsdaten in eine neu anzulegende Datei eintragen, welche dann auch wieder als Umgebungsvariablen in der Anwendung verfügbar gemacht werden.

Die Zugangsdaten werden euch in der Session zur Verfügung gestellt und müssen in der Datei "pg-datenbank.env" gespeichert werden.

![](../../../../.gitbook/assets/image%20%2835%29.png)

Nachdem das File im Ordner angelegt ist kann deployed werden mit Folgendem Befehl:

```text
oc new-app https://github.com/maxisses/sensorapp.git --context-dir=iot-subscriber/ --strategy=docker --env-file=backend-env.env --env-file=pg-datenbank.env --name=backend -l name=backend -l app.kubernetes.io/part-of=sensorapp -l app.kubernetes.io/name=python
```

![](../../../../.gitbook/assets/image%20%2817%29.png)

